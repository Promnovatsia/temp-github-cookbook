<section ng-controller="ShelfController" ng-init="findOne()">
    <div class="page-header">
        <h1 ng-show="shelf.id">
            Настройка полки: {{info.caption}}
        </h1>
        <h1 ng-hide="shelf.id">
            Новая полка
        </h1>
    </div>
    <div class="col-md-12">
        <form name="shelfForm" class="form-horizontal" ng-submit="save(shelfForm.$valid)" novalidate>
            <fieldset>
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-8" ng-hide="info.caption">
                            <div class="input-group">
                                <input type="text" class="form-control"
                                    ng-model="selectedIngridient"
                                    data-animation="am-flip-x"
                                    bs-options="obj.id as obj.caption for obj in getIngridientList()"
                                    placeholder="Выберите ингредиент"
                                    select-mode="true"
                                    bs-typeahead
                                >
                                <span class="input-group-addon" ng-click="setIngridient(selectedIngridient)">
                                    <span class="glyphicon glyphicon-ok"></span>
                                </span> 
                            </div>
                        </div>
                        <div ng-show="info.caption">
                            <div class="col-md-2">
                                <span ng-if="info.image">
                                    <img ng-src="{{imageurl}}{{info.image}}" class="img-thumbnail user-profile-picture">
                                </span>
                            </div>
                            <div class="col-md-6">
                                <p class="lead" ng-bind="info.card"></p>
                            </div>
                            <div class="col-md-4">
                                <label class="btn btn-link">
                                    <snap class="glyphicon glyphicon-transfer"></snap>
                                    Замена для {{shelf.override}} <!-- //FUTURE override UI-->
                                </label>
                                <label class="btn btn-link">
                                    <snap class="glyphicon glyphicon-transfer"></snap>
                                    Заменимо на {{shelf.fallback}} <!-- //FUTURE fallback UI-->
                                </label>
                                <label class="btn btn-danger" ng-click="setIngridient(false)">
                                    <snap class="glyphicon glyphicon-remove-sign"></snap>
                                    Отвязать ингредиент
                                </label>
                            </div>
                        </div>
                    </div><hr/>
                    <div class="row">     
                        <label for="stored">
                            В наличии //TODO единицы измерения
                            //TODO выравнивание
                        </label>
                        <progressbar class="{{shelf.progressbar.class}}" value="shelf.progressbar.value" type="{{shelf.progressbar.type}}" max="100">
                            <span style="color:white; white-space:nowrap;"> 
                                {{shelf.progressbar.text}}
                            </span>
                        </progressbar>
                        <uib-progress>
                            <uib-bar value="10" type="default">
                                <span style="color:white; white-space:nowrap;"> 
                                    Пусто
                                </span>
                            </uib-bar>
                            <uib-bar value="10" type="danger">
                                <span style="color:white; white-space:nowrap;"> 
                                    Дефицит
                                </span>
                            </uib-bar>
                            <uib-bar value="30" type="warning">
                                <span style="color:white; white-space:nowrap;"> 
                                    Недостаточно
                                </span>
                            </uib-bar>
                            <uib-bar value="30" type="success">
                                <span style="color:white; white-space:nowrap;"> 
                                    Достаточно
                                </span>
                            </uib-bar>
                            <uib-bar value="20" type="info">
                                <span style="color:white; white-space:nowrap;"> 
                                    Избыток
                                </span>
                            </uib-bar>
                        </uib-progress>
                    </div><hr/>
                    <div class="row">
                        <div class="col-md-2">
                            <label for="deficit">
                                Порог дефицита    
                            </label>
                        </div>
                        <div class="col-md-2">
                            <div ng-hide="form.input.deficit">
                                <div class="btn-group">
                                    <label class="btn btn-default" ng-click="shelf.deficit = shelf.deficit - 1 ; settingsUpdate()">
                                        <snap class="glyphicon glyphicon-minus"></snap>
                                    </label>
                                    <label class="btn btn-default" ng-click="form.input.deficit = true">
                                        {{shelf.deficit}} {{info.measure}}
                                    </label>
                                    <label class="btn btn-default" ng-click="shelf.deficit = shelf.deficit + 1 ; settingsUpdate()">
                                        <snap class="glyphicon glyphicon-plus"></snap>
                                    </label>
                                </div> 
                            </div>
                            <div ng-show="form.input.deficit">
                                <div class="input-group">
                                    <label class="input-group-addon">
                                        {{info.measure}}
                                    </label>
                                    <input name="deficit" type="number" ng-model="shelf.deficit" class="form-control">
                                    <label class="input-group-addon" ng-click="form.input.deficit = false">
                                        OK
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div><hr/>
                    <div class="row">
                        <div class="col-md-2">
                            <label for="desired">
                                Порог достаточного    
                            </label>
                        </div>
                        <div class="col-md-2">
                            <div ng-hide="form.input.desired">
                                <div class="btn-group">
                                    <label class="btn btn-default" ng-click="setParam(shelf.desired,-1)">
                                        <snap class="glyphicon glyphicon-minus"></snap>
                                    </label>
                                    <label class="btn btn-default" ng-click="form.input.desired = true">
                                        {{shelf.desired}} {{info.measure}}
                                    </label>
                                    <label class="btn btn-default" ng-click="setParam(shelf.desired, 1)">
                                        <snap class="glyphicon glyphicon-plus"></snap>
                                    </label>
                                </div> 
                            </div>
                            <div ng-show="form.input.desired">
                                <div class="input-group">
                                    <label class="input-group-addon">
                                        {{info.measure}}
                                    </label>
                                    <input name="desired" type="number" ng-model="shelf.desired" class="form-control">
                                    <label class="input-group-addon" ng-click="form.input.desired = false">
                                        OK
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                    </div><hr/>
                    <div class="row">
                        <div class="col-md-2">
                            <label for="max">
                                Порог избытка    
                            </label>
                        </div>
                        <div ng-hide="form.input.max" class="col-md-2">
                            <div class="btn-group">
                                <label class="btn btn-default" ng-click="setParam(shelf.max,-1)">
                                    <snap class="glyphicon glyphicon-minus"></snap>
                                </label>
                                <label class="btn btn-default" ng-click="form.input.max = true">
                                    {{shelf.max}} {{info.measure}}
                                </label>
                                <label class="btn btn-default" ng-click="setParam(shelf.max, 1)">
                                    <snap class="glyphicon glyphicon-plus"></snap>
                                </label>
                            </div> 
                        </div>
                        <div ng-show="form.input.max" class="col-md-2">
                            <div class="input-group">
                                <label class="input-group-addon">
                                    {{info.measure}}
                                </label>
                                <input name="deficit" type="number" ng-model="shelf.max" class="form-control">
                                <label class="input-group-addon" ng-click="form.input.max = false">
                                    OK
                                </label>
                            </div>
                        </div>
                    </div><hr/>
                    
                    <label for="stored">
                        STORED     
                    </label>
                    <input name="stored" type="number" ng-model="shelf.stored" class="form-control">
                    
                    <button ng-click="shelf.stored = shelf.stored +1; progressUpdate(shelf)">sto+1</button>
                    <button ng-click="shelf.stored = shelf.stored -1; progressUpdate(shelf)">sto-1</button>
                    
                    <label for="isSpoiled">
                        isSpoiled
                    </label> 
                    <label class="{{btnIsSpoiledTrue}}" ng-click="spoilUpdate(false)">Well</label>
                    <label class="{{btnIsSpoiledFalse}}" ng-click="spoilUpdate(true)">Spoiled!</label>                
                    
                    <!-- //TODO place UI-->  
                    <!-- //TODO shelfQuery UI-->    
                </div>
                <pre>
                    {{shelf | json}} <!--FIXME remove json shelf on delevopment-->
                </pre>
                    
                <div class="form-group">
                    <input type="submit" class="btn btn-default" value="{{shelf.id ? 'Update' : 'Create'}}">
                </div>
                <div ng-show="error" class="text-danger">
                    <strong ng-bind="error"></strong>
                </div>
            </fieldset>
        </form>
    </div>
</section>